stage('Install Dependencies') {
    steps {
        echo 'Installing Python dependencies from root requirement.txt'
        sh '''
            # ลบ venv เก่าทิ้งถ้ามีอยู่
            if [ -d "venv" ]; then
                echo "Removing old virtual environment..."
                rm -rf venv
            fi

            # สร้าง venv ใหม่
            python3 -m venv venv
            . venv/bin/activate

            # อัปเกรด pip และติดตั้ง dependencies ใหม่ทั้งหมด
            pip install --upgrade pip
            pip install -r requirement.txt
        '''
    }
}
